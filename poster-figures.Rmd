---
title: "Environmental Noise and Ross-Macdonald Transmission Models"
author: "Karin Ebey, John Vinson and Kyle Dahlin"
date: "`r Sys.Date()`"
link-citations: yes
csl: proceedings-of-the-royal-society-b.csl
bibliography: bibliography.bib
output:
  pdf_document: 
    extra_dependencies: ["float"]
    keep_tex: yes
knit: (function(inputFile, encoding) {
  rmarkdown::render(inputFile, encoding = encoding, output_dir = "doc") })
---

```{r setup, include=FALSE}
# Load libraries (trim this list down to the essentials)
library(ggplot2)
library(tidyverse)
library(cowplot)
library(viridis)
library(latex2exp)
library(scales)
library(cols4all)

# # Parallelization settings
# n_cores <- floor((detectCores() - 1) / 2)
# registerDoParallel(cores = n_cores)

# Knitr settings (hides all chunk outputs besides figures and centers figures)
knitr::opts_chunk$set(
  echo = FALSE, cache = FALSE, warning = FALSE, message = FALSE, fig.pos = "H",
  dev = c("pdf", "png"),
  out.extra = ""
)

R0_cols = rev(c("#3A549F", "#5487BD", "#F3E3AB", "#FDC274", "#F89355", "#E45036", "#B00C27"))
R0_vals = rev(c("0.75", "0.95", "1.05", "1.25", "2", "4", "6.5"))
```

```{r Load and format data from Julia}
# results from 1000 runs of 100 iterations
# jop_results <- read.csv("julia_oprob_results1.csv")
# jop_results$R0 <- jop_results$Tvh
# jop_results$R0 <- replace(jop_results$R0, jop_results$R0==0.0125, 'R0=0.75')
# jop_results$R0  <- replace(jop_results$R0, jop_results$R0==0.02005556, 'R0=0.95')
# jop_results$R0  <- replace(jop_results$R0, jop_results$R0==0.0245, 'R0=1.05')
# jop_results$R0  <- replace(jop_results$R0, jop_results$R0==0.35555556, 'R0=4')
```


# Outbreak probability
```{r oprob_boxplot, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEproboutbreak} Probability of an outbreak by sigma and R0 based on 1000 runs of 100 iterations.'}
# ggplot(data = jop_results , mapping = aes(x = as.factor(sigma), y = oprob_mean)) +
#   geom_boxplot()+facet_wrap(~as.factor(R0), ncol = 1)+ylim(0,1)+theme_cowplot()+ylab('Probability of an outbreak')+
#   xlab('sigma')
#
# p1 = ggplot(data = jop_results , mapping = aes(x = as.factor(sigma), y = oprob_mean)) +
#   geom_boxplot()+facet_wrap(~as.factor(R0), ncol = 1)+ylim(0,1)+theme_cowplot()+ylab('Probability of an outbreak')+
#   xlab('sigma')

# ggsave('oprob4.png')
```

```{r oprob_boxplot_allinone,  out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEproboutbreak_allinone} Probability of an outbreak by sigma and R0 based on 1000 runs of 100 iterations.'}
# ggplot(data = jop_results , mapping = aes(x = as.factor(sigma), y = oprob_mean,  color=R0)) +
#   geom_boxplot()+ylim(0,1)+theme_cowplot()+ylab('Probability of an outbreak')+
#   xlab('sigma')
# ggsave('oprob1.png')
```


# Number of cases
```{r numcases_boxplot, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEnuminfected} Number of hosts infected at the end of simulation (only including simulations where the outbreak did not die out) by sigma and R0 based on 1000 runs of 100 iterations.'}
# ggplot(data = jop_results[jop_results$oprob_mean !=0,], mapping = aes(x = as.factor(sigma), y = num_cases)) +
#   geom_boxplot()+facet_wrap(~as.factor(R0), ncol = 1)+theme_cowplot()+ylab('Average number of hosts infected')+
#   xlab('sigma')
# ggsave('numcases4.png')
```

```{r numcases_boxplot_allinone, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEnuminfected_allinone} Number of hosts infected at the end of simulation (only including simulations where the outbreak did not die out) by sigma and R0 based on 1000 runs of 100 iterations.'}
# ggplot(data = jop_results[jop_results$oprob_mean !=0,] , mapping = aes(x = as.factor(sigma), y = num_cases,  color=R0)) +
#   geom_boxplot()+theme_cowplot()+ylab('Average number of hosts infected')+
#   xlab('sigma')
# ggsave('numcases1.png')
```

# Time to outbreak extinction
```{r endtime_boxplot, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEendtime} Time that the outbreak died out (only including simulations where the outbreak did die out) by sigma and R0 based on 1000 runs of 100 iterations.'}
# ggplot(data = jop_results[jop_results$oprob_mean !=1,] , mapping = aes(x = as.factor(sigma), y = end_time)) +
#   geom_boxplot()+facet_wrap(~as.factor(R0), ncol = 1)+theme_cowplot()+ylab('Average time outbreak dies out')+
#   xlab('sigma')
# ggsave('endtime4.png')
```

```{r endtime_boxplot_allinone, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEendtime_allinone} Time that the outbreak died out (only including simulations where the outbreak did die out) by sigma and R0 based on 1000 runs of 100 iterations.'}
# ggplot(data = jop_results[jop_results$oprob_mean !=1,] , mapping = aes(x = as.factor(sigma), y = end_time,  color=R0)) +
#   geom_boxplot()+theme_cowplot()+ylab('Average time outbreak dies out')+
#   xlab('sigma')
# ggsave('endtime1.png')
```


#Results from Julia
```{r}
jop <- read.csv("results/propSDE_means.csv")
# rbind(read.csv("results/means_1.csv"),
#            read.csv("results/means_2.csv"),
#            read.csv("results/means_3.csv"),
#            read.csv("results/means_4.csv"),
#            read.csv("results/means_5.csv"),
#            read.csv("results/means_6.csv"),
#            read.csv("results/means_7.csv")
#            )
#read.csv("code/julia/test.csv")
# jop$R0 <- jop$Thv
# Thv_list <- unique(jop$Thv)
# jop$R0 <- replace(jop$R0, jop$R0 == Thv_list[1], 0.75)
# jop$R0 <- replace(jop$R0, jop$R0 == Thv_list[2], 0.95)
# jop$R0 <- replace(jop$R0, jop$R0 == Thv_list[3], 1.05)
# jop$R0 <- replace(jop$R0, jop$R0 == Thv_list[4], 1.25)
# jop$R0 <- replace(jop$R0, jop$R0 == Thv_list[5], 2)
# jop$R0 <- replace(jop$R0, jop$R0 == Thv_list[6], 4)
# jop$R0 <- replace(jop$R0, jop$R0 == Thv_list[7], 6.5)
```

```{r Fig-3, out.width='100%', fig.align='center', fig.cap='\\label{fig:combined_outputs} Probability of the disease becoming endemic by sigma and R0 based on 1000 runs of 100 iterations. Overall, increasing environmental noise strength cases the probability that the disease becomes endemic to decrease. For smaller R0 values (i.e. <1.25), there is a slight increase in endemic disease probability at high environmental noise levels. Above environmental noise strength of 0.4 (where there is up to 40% variation in parameter values), the probability of endemic disease goes to zero. There is a greater probability of the disease going endemic at higher values of R0.'}

plot_df <- jop %>% 
  select(sigma, prob_end_mean, prob_end_25, prob_end_75, 
         prob_out100_mean, prob_out100_25, prob_out100_75,
         max_cases_all_mean, max_cases_all_25, max_cases_all_75,
         R0) %>% 
  pivot_longer(cols = -c(sigma, R0)) %>% 
  mutate(output = stringr::str_extract(name, "[^_]*_[^_]*"),
         type = stringi::stri_reverse(str_split_i(stringi::stri_reverse(name), '_', i = 1))
  ) %>% 
  mutate(output = case_when(output == "prob_end" ~ "(a) Probability disease is endemic",
                            output == "prob_out100" ~ "(b) Probability of an outbreak > 100 hosts",
                            output == "max_cases" ~ "(c) Peak number of cases")) %>% 
  select(-name) %>%
  mutate(across(output, ~factor(., levels = c("(a) Probability disease is endemic", "(b) Probability of an outbreak > 100 hosts","(c) Peak number of cases")))) %>% 
  pivot_wider(id_cols = c(sigma, R0, output), names_from = type) %>% 
  arrange(sigma, R0)

R0_colors = rev(c4a("tableau.classic_orange_blue", 20))[c(1:3, 10:20)]

# plot <- ggplot(plot_df, aes(x = sigma)) +
#   geom_line(aes(y =  mean, color = as.factor(R0), group = as.factor(R0))) +
#   geom_point(aes(y =  mean, color = as.factor(R0), group = as.factor(R0))) +
#   geom_ribbon(aes(ymin = `25`, ymax = `75`, fill = as.factor(R0)), alpha = 0.3) +
#   # scale_color_viridis(discrete=TRUE, guide = "legend")+
#   # scale_fill_viridis(discrete=TRUE)+
#   # scale_color_manual(values = R0_colors) + #, breaks = R0_vals) +
#   # scale_fill_manual(values = R0_colors)  +#, breaks = R0_vals) +
#   facet_wrap(~ output, ncol = 1, scales = "free", strip.position = "top") +
#   theme_cowplot() +
#   # labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
#   xlab(unname(TeX("Environmental noise strength $(\\sigma)$"))) +
#   ylab("") +
#   theme(strip.text.x = element_text(hjust = 0),
#         strip.background = element_blank()) +
#   theme_minimal_grid()
# plot

plot1 <- filter(plot_df, output == "(a) Probability disease is endemic") %>% 
  ggplot() +
  geom_contour_filled(aes(x = sigma, y = R0, z = mean)) +
  theme_cowplot() +
  # labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$"))) +
  ylab(TeX("Basic reproduction number $\\,(R_0)$")) +
  labs(fill = "Pr(disease is endemic)") +
  theme(strip.text.x = element_text(hjust = 0),
        strip.background = element_blank()) +
  theme_minimal_grid()

plot2 <- filter(plot_df, output == "(b) Probability of an outbreak > 100 hosts") %>% 
  ggplot() +
  geom_contour_filled(aes(x = sigma, y = R0, z = mean)) +
  theme_cowplot() +
  # labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$"))) +
  ylab(TeX("Basic reproduction number $\\,(R_0)$")) +
  labs(fill = "Pr(outbreak > 100 hosts)") +
  theme(strip.text.x = element_text(hjust = 0),
        strip.background = element_blank()) +
  theme_minimal_grid()
plot2

plot3 <- filter(plot_df, output == "(c) Peak number of cases") %>% 
  ggplot() +
  geom_contour_filled(aes(x = sigma, y = R0, z = mean)) +
  theme_cowplot() +
  # labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$"))) +
  ylab(TeX("Basic reproduction number $\\,(R_0)$")) +
  labs(fill = "Peak number of cases") +
  theme(strip.text.x = element_text(hjust = 0),
        strip.background = element_blank()) +
  theme_minimal_grid()
plot3

final_plot = plot_grid(plot1, plot2, plot3, align = 'h')

ggsave("figures/figure_3.png", height = 8, width = 7)
```


```{r prob_end, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEprob_end} Probability of the disease becoming endemic by sigma and R0 based on 1000 runs of 100 iterations. Overall, increasing environmental noise strength cases the probability that the disease becomes endemic to decrease. For smaller R0 values (i.e. <1.25), there is a slight increase in endemic disease probability at high environmental noise levels. Above environmental noise strength of 0.4 (where there is up to 40% variation in parameter values), the probability of endemic disease goes to zero. There is a greater probability of the disease going endemic at higher values of R0.'}

ggplot(jop, aes(x = sigma, y = prob_end_mean)) +
  geom_line(aes(color = as.factor(R0))) +
  geom_point(aes(color = as.factor(R0))) +
  geom_ribbon(aes(ymin = prob_end_25, ymax = prob_end_75, fill = as.factor(R0)), alpha = 0.3) +
  # scale_color_viridis(discrete=TRUE, guide = "legend")+
  # scale_fill_viridis(discrete=TRUE)+
  scale_color_manual(values = R0_cols, breaks = R0_vals) + 
  scale_fill_manual(values = R0_cols, breaks = R0_vals) +
  theme_cowplot() +
  ylab("Probability disease becomes endemic") +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$")))

ggsave("figures/prob_end.png", height = 4, width = 7)
```
```{r prob_out10, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEprob_out10} Probability of an outbreak (defined as 10 host cases at one time point) occuring by sigma and R0 based on 1000 runs of 100 iterations. For R0 values greater than 1, as environmental noise strength increases the probability of an outbreak decreases. For R0 values less than 1, as environmental noise strength increases, the probability of an outbreak increases until sigma=~0.2 and then decreases. There is a greater probability of an outbreak at higher values of R0.'}
ggplot(jop, aes(x = sigma, y = prob_out10_mean)) +
  geom_line(aes(color = as.factor(R0))) +
  geom_point(aes(color = as.factor(R0))) +
  geom_ribbon(aes(ymin = prob_out10_25, ymax = prob_out10_75, fill = as.factor(R0)), alpha = 0.3) +
  # scale_color_viridis(discrete=TRUE, guide = "legend")+
  # scale_fill_viridis(discrete=TRUE)+
  scale_color_manual(values = R0_cols, breaks = R0_vals) + 
  scale_fill_manual(values = R0_cols, breaks = R0_vals) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  ylab("Probability of outbreak > 10 hosts") +
  ylim(0, 1) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$")))
ggsave("figures/prob_out10.png", height = 4, width = 7)
```
```{r prob_out100, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEprob_out100} Probability of an outbreak (defined as 100 host cases at one time point) occuring by sigma and R0 based on 1000 runs of 100 iterations. In general, for R0 values greater than 1, as environmental noise strength increases the probability of an outbreak decreases. For R0 values less than 1, as environmental noise strength increases, the probability of an outbreak increases until sigma=~0.25 and then decreases. R0=1.05 follows both patterns to some degree. There is a greater probability of an outbreak at higher values of R0.'}
ggplot(jop, aes(x = sigma, y = prob_out100_mean)) +
  geom_line(aes(color = as.factor(R0))) +
  geom_point(aes(color = as.factor(R0))) +
  geom_ribbon(aes(ymin = prob_out100_25, ymax = prob_out100_75, fill = as.factor(R0)), alpha = 0.3) +
  ylab("Probability of an outbreak > 100") +
  scale_color_manual(values = R0_cols, breaks = R0_vals) + 
  scale_fill_manual(values = R0_cols, breaks = R0_vals) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$")))
ggsave("figures/prob_out100.png", height = 7, width = 7)
```
```{r max_cases_all, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEmax_cases_all} Maximum number of cases during the simulation by sigma and R0 based on 1000 runs of 100 iterations. For all R0 values, the maximum number of cases increases with environmental noise strength initially and then decreases as environmental noise strength gets too high. For high R0 values, the shift occurs at sigma=~0.15, and for lower R0 values, the shift occurs at sigma=~0.25. R0=1.25 shows intermediate behavior responding at both sigma values. With higher values of R0, more hosts are infected.'}
ggplot(jop, aes(x = sigma, y = max_cases_all_mean)) +
  geom_line(aes(color = as.factor(R0))) +
  geom_point(aes(color = as.factor(R0))) +
  geom_ribbon(aes(ymin = max_cases_all_25, ymax = max_cases_all_75, fill = as.factor(R0)), alpha = 0.3) +
  ylab("Peak number of cases") +
  # scale_color_viridis(discrete=TRUE, guide = "legend")+scale_fill_viridis(discrete=TRUE)+
  scale_color_manual(values = R0_cols, breaks = R0_vals) + 
  scale_fill_manual(values = R0_cols, breaks = R0_vals) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$"))) +
  ggtitle("All simulations") +
  theme(text = element_text(size = 20))
ggsave("figures/max_cases.png", height = 4, width = 7)
```
```{r max_cases_out, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEmax_cases_all} Maximum number of cases during the simulation by sigma and R0 based on 1000 runs of 100 iterations only including simulations where the outbreak died out. For all R0 values, the maximum number of cases increases with environmental noise strength initially and then decreases as environmental noise strength gets too high. For high R0 values, the shift occurs at sigma=~0.15, and for lower R0 values, the shift occurs at sigma=~0.25. R0=1.25 shows intermediate behavior responding at both sigma values. With higher values of R0, more hosts are infected.'}
ggplot(jop, aes(x = sigma, y = max_cases_out_mean)) +
  geom_line(aes(color = as.factor(R0))) +
  geom_point(aes(color = as.factor(R0))) +
  geom_ribbon(aes(ymin = max_cases_out_25, ymax = max_cases_out_75, fill = as.factor(R0)), alpha = 0.3) +
  ylab("Peak number of cases") +
  # scale_color_viridis(discrete=TRUE, guide = "legend")+scale_fill_viridis(discrete=TRUE)+
  scale_color_manual(values = R0_cols, breaks = R0_vals) + 
  scale_fill_manual(values = R0_cols, breaks = R0_vals) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$"))) +
  ggtitle("Only simulations where disease died out") +
  theme(text = element_text(size = 20))
ggsave("figures/max_cases.png", height = 7, width = 7.6)
```


```{r end_time, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEend_time} Time that the outbreak dies out (or 10 years-end of simulation) by sigma and R0 based on 1000 runs of 100 iterations. This graph looks quite similar to that of the probability of disease going endemic, because if the disease does not go endemic, the disease goes extinct early on in the simulation.'}
ggplot(jop, aes(x = sigma, y = end_time_mean / 365)) +
  geom_line(aes(color = as.factor(R0))) +
  geom_point(aes(color = as.factor(R0))) +
  geom_ribbon(aes(ymin = end_time_25 / 365, ymax = end_time_75 / 365, fill = as.factor(R0)), alpha = 0.3) +
  ylab("Outbreak duration (years)") +
  # scale_color_viridis(discrete=TRUE, guide = "legend")+scale_fill_viridis(discrete=TRUE)+
  scale_color_manual(values = R0_cols, breaks = R0_vals) + 
  scale_fill_manual(values = R0_cols, breaks = R0_vals) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$"))) +
  ggtitle("All simulations") +
  theme(text = element_text(size = 20))
ggsave("figures/end_time.png", height = 7, width = 7.6)
```
```{r end_time_out, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEend_time} Time that the outbreak dies out (or 10 years-end of simulation) by sigma and R0 based on 1000 runs of 100 iterations. This graph looks quite similar to that of the probability of disease going endemic, because if the disease does not go endemic, the disease goes extinct early on in the simulation.'}
ggplot(jop, aes(x = sigma, y = end_time_out_mean / 365)) +
  geom_line(aes(color = as.factor(R0))) +
  geom_point(aes(color = as.factor(R0))) +
  geom_ribbon(aes(ymin = end_time_out_25 / 365, ymax = end_time_out_75 / 365, fill = as.factor(R0)), alpha = 0.3) +
  ylab("Outbreak duration (years)") +
  # scale_color_viridis(discrete=TRUE, guide = "legend")+scale_fill_viridis(discrete=TRUE)+
  scale_color_manual(values = R0_cols, breaks = R0_vals) + 
  scale_fill_manual(values = R0_cols, breaks = R0_vals) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$"))) +
  ggtitle("Only simulations where disease died out") +
  theme(text = element_text(size = 20))
ggsave("figures/end_time.png", height = 7, width = 7.6)
```


```{r time_max, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEtime_max} Time when the maximum number of cases occured during the simulation by sigma and R0 based on 1000 runs of 100 iterations.'}
ggplot(jop, aes(x = sigma, y = time_max_mean)) +
  geom_line(aes(color = as.factor(R0))) +
  geom_point(aes(color = as.factor(R0))) +
  geom_ribbon(aes(ymin = time_max_25, ymax = time_max_75, fill = as.factor(R0)), alpha = 0.3) +
  ylab("Time of maximum number of cases") +
  scale_color_viridis(discrete = TRUE, guide = "legend") +
  scale_fill_viridis(discrete = TRUE) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$")))
```
```{r num_cases, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEnum_cases} Number of host cases at the end of the simulation by sigma and R0 based on 1000 runs of 100 iterations. This graph looks similar to that of the probability of disease going endemic, because if the disease does not go endemic, then zero hosts are infected at the end. More hosts are infected at higher R0 values.'}
ggplot(jop, aes(x = sigma, y = num_cases_mean)) +
  geom_line(aes(color = as.factor(R0))) +
  geom_point(aes(color = as.factor(R0))) +
  geom_ribbon(aes(ymin = num_cases_25, ymax = num_cases_75, fill = as.factor(R0)), alpha = 0.3) +
  ylab("Number of cases at end") +
  scale_color_viridis(discrete = TRUE, guide = "legend") +
  scale_fill_viridis(discrete = TRUE) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$")))
```
```{r num_cases2, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEnum_cases} Number of host cases at the end of the simulation by sigma and R0 based on 1000 runs of 100 iterations. This graph looks similar to that of the probability of disease going endemic, because if the disease does not go endemic, then zero hosts are infected at the end. More hosts are infected at higher R0 values.'}
ggplot(jop, aes(x = sigma, y = num_cases_mean)) +
  geom_line(aes(color = as.factor(R0))) +
  geom_point(aes(color = as.factor(R0))) +
  geom_ribbon(aes(ymin = num_cases_25, ymax = num_cases_75, fill = as.factor(R0)), alpha = 0.3) +
  ylab("Number of cases at end") +
  scale_color_viridis(discrete = TRUE, guide = "legend") +
  scale_fill_viridis(discrete = TRUE) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$")))
```



```{r}
jop$R0_cond <- jop$R0
jop$R0_cond <- replace(jop$R0_cond, jop$R0_cond < 1, "<1")
jop$R0_cond <- replace(jop$R0_cond, jop$R0_cond > 1, ">1")
jop$sig_cond <- jop$sigma
jop$sig_cond <- replace(jop$sig_cond, jop$sig_cond == 0 | jop$sig_cond == 0.02 | jop$sig_cond == 0.04 | jop$sig_cond == 0.06 | jop$sig_cond == 0.08 | jop$sig_cond == 0.1 | jop$sig_cond == 0.12, "low")
jop$sig_cond <- replace(jop$sig_cond, jop$sig_cond == 0.14 | jop$sig_cond == 0.16 | jop$sig_cond == 0.18 | jop$sig_cond == 0.2 | jop$sig_cond == 0.22 | jop$sig_cond == 0.24 | jop$sig_cond == 0.26, "med")
jop$sig_cond <- replace(jop$sig_cond, jop$sig_cond == 0.28 | jop$sig_cond == 0.3 | jop$sig_cond == 0.32 | jop$sig_cond == 0.34 | jop$sig_cond == 0.36 | jop$sig_cond == 0.38 | jop$sig_cond == 0.4, "high")
```

```{r}
ggplot(jop, aes(x = prob_end_mean, y = prob_out10_mean)) +
  geom_point(aes(shape = R0_cond, color = sig_cond)) +
  ylim(0, 1) +
  geom_line(aes(x = prob_end_mean, y = prob_end_mean)) +
  scale_color_viridis(discrete = TRUE) +
  theme_cowplot()
```
```{r}
ggplot(jop, aes(x = prob_end_mean, y = prob_out100_mean)) +
  geom_point() +
  ylim(0, 1) +
  geom_line(aes(x = prob_end_mean, y = prob_end_mean))
```


#Max cases and end time endemic vs not exploration
```{r}
jopmt <- read.csv("results/max_case_end_time_expo.csv")
jopmt$R0 <- jopmt$Thv
Thv_list <- unique(jopmt$Thv)
jopmt$R0 <- replace(jopmt$R0, jopmt$R0 == Thv_list[1], 0.75)
jopmt$R0 <- replace(jopmt$R0, jopmt$R0 == Thv_list[2], 0.95)
jopmt$R0 <- replace(jopmt$R0, jopmt$R0 == Thv_list[3], 1.05)
jopmt$R0 <- replace(jopmt$R0, jopmt$R0 == Thv_list[4], 1.25)
jopmt$R0 <- replace(jopmt$R0, jopmt$R0 == Thv_list[5], 2)
jopmt$R0 <- replace(jopmt$R0, jopmt$R0 == Thv_list[6], 4)
jopmt$R0 <- replace(jopmt$R0, jopmt$R0 == Thv_list[7], 6.5)
```
```{r max_cases_all, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEmax_cases_all} Maximum number of cases during the simulation by sigma and R0 based on 1000 runs of 100 iterations. For all R0 values, the maximum number of cases increases with environmental noise strength initially and then decreases as environmental noise strength gets too high. For high R0 values, the shift occurs at sigma=~0.15, and for lower R0 values, the shift occurs at sigma=~0.25. R0=1.25 shows intermediate behavior responding at both sigma values. With higher values of R0, more hosts are infected.'}
ggplot(jopmt, aes(x = sigma, y = max_cases_all_mean)) +
  geom_line(aes(color = as.factor(R0))) +
  geom_point(aes(color = as.factor(R0))) +
  geom_ribbon(data = jopmt, aes(x = sigma, ymin = max_cases_all_25, ymax = max_cases_all_75, fill = as.factor(R0)), alpha = 0.3) +
  ylab("Peak number of cases") +
  # scale_color_viridis(discrete=TRUE, guide = "legend")+scale_fill_viridis(discrete=TRUE)+
  scale_color_manual(values = R0_cols, breaks = R0_vals) + 
  scale_fill_manual(values = R0_cols, breaks = R0_vals) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$")))
# ggsave('max_cases.png', height = 7, width = 7)
```
```{r max_cases_all, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEmax_cases_all} Maximum number of cases during the simulation by sigma and R0 based on 1000 runs of 100 iterations. For all R0 values, the maximum number of cases increases with environmental noise strength initially and then decreases as environmental noise strength gets too high. For high R0 values, the shift occurs at sigma=~0.15, and for lower R0 values, the shift occurs at sigma=~0.25. R0=1.25 shows intermediate behavior responding at both sigma values. With higher values of R0, more hosts are infected.'}
ggplot(jopmt, aes(x = sigma, y = max_cases_end_mean)) +
  geom_line(aes(color = as.factor(R0))) +
  geom_point(aes(color = as.factor(R0))) +
  ylab("Maximum number of cases") +
  scale_color_viridis(discrete = TRUE, guide = "legend") +
  scale_fill_viridis(discrete = TRUE) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$")))
ggsave("figures/max_cases_end.png", height = 7, width = 7)
```
```{r max_cases_all, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEmax_cases_all} Maximum number of cases during the simulation by sigma and R0 based on 1000 runs of 100 iterations. For all R0 values, the maximum number of cases increases with environmental noise strength initially and then decreases as environmental noise strength gets too high. For high R0 values, the shift occurs at sigma=~0.15, and for lower R0 values, the shift occurs at sigma=~0.25. R0=1.25 shows intermediate behavior responding at both sigma values. With higher values of R0, more hosts are infected.'}
ggplot(jopmt, aes(x = sigma, y = max_cases_out_mean)) +
  geom_line(aes(color = as.factor(R0))) +
  geom_point(aes(color = as.factor(R0))) +
  ylab("Peak number of cases") +
  # scale_color_viridis(discrete=TRUE, guide = "legend")+scale_fill_viridis(discrete=TRUE)+
  scale_color_manual(values = R0_cols, breaks = R0_vals) + 
  scale_fill_manual(values = R0_cols, breaks = R0_vals) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$"))) +
  ggtitle("Only simulations where disease dies out")
ggsave("figures/max_cases_out.png", height = 7, width = 7.6)
```
```{r end_time, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEend_time} Time that the outbreak dies out (or 10 years-end of simulation) by sigma and R0 based on 1000 runs of 100 iterations. This graph looks quite similar to that of the probability of disease going endemic, because if the disease does not go endemic, the disease goes extinct early on in the simulation.'}
ggplot(jopmt, aes(x = sigma, y = end_time_mean / 365)) +
  geom_line(aes(color = as.factor(R0))) +
  geom_point(aes(color = as.factor(R0))) +
  geom_ribbon(aes(ymin = end_time_25 / 365, ymax = end_time_75 / 365, fill = as.factor(R0)), alpha = 0.3) +
  ylab("Time outbreak dies out (years)") +
  scale_color_viridis(discrete = TRUE, guide = "legend") +
  scale_fill_viridis(discrete = TRUE) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$")))
ggsave("figures/end_time.png", height = 7, width = 7)
```


```{r max_cases_all, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEmax_cases_all} Maximum number of cases during the simulation by sigma and R0 based on 1000 runs of 100 iterations. For all R0 values, the maximum number of cases increases with environmental noise strength initially and then decreases as environmental noise strength gets too high. For high R0 values, the shift occurs at sigma=~0.15, and for lower R0 values, the shift occurs at sigma=~0.25. R0=1.25 shows intermediate behavior responding at both sigma values. With higher values of R0, more hosts are infected.'}
ggplot(jopmt, aes(x = sigma, y = end_time_out_mean / 365)) +
  geom_line(aes(color = as.factor(R0))) +
  geom_point(aes(color = as.factor(R0))) +
  ylab("Outbreak duration (years)") +
  # scale_color_viridis(discrete=TRUE, guide = "legend")+scale_fill_viridis(discrete=TRUE)+
  scale_color_manual(values = R0_cols, breaks = R0_vals) + 
  scale_fill_manual(values = R0_cols, breaks = R0_vals) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$"))) +
  ggtitle("Only simulations where disease dies out")
ggsave("figures/end_time_out.png", height = 7, width = 7.6)
```







#Trajectories Plot
```{r}
jtd <- read_csv("results/julia_trajectories_deterministic.csv")
jts1 <- read_csv("results/traj_envstoc_1.csv")
jts2 <- read_csv("results/traj_envstoc_2.csv")
jts3 <- read_csv("results/traj_envstoc_3.csv")
jts4 <- read_csv("results/traj_envstoc_4.csv")
jts5 <- read_csv("results/traj_envstoc_5.csv")
jts1$traj <- 1
jts2$traj <- 5
jts3$traj <- 3
jts4$traj <- 4
jts5$traj <- 2
jtse <- rbind(jts1, jts2, jts3, jts4, jts5)
jtse <- jtse[jtse$value2 >= 0, ]
jtse <- jtse[jtse$value1 >= 0, ]


# ats <- read_csv('avg_traj_stoc.csv')
# ats <- ats[ats$M>=0,]
# ats <- ats[ats$H>=0,]
# ahs <- aggregate(ats$H, list(ats$t), FUN=mean)
#
# atds <-read_csv('avg_traj_demstoc.csv')
# atds <- atds[atds$M>=0,]
# atds <- atds[atds$H>=0,]
# ahds <- aggregate(atds$H, list(atds$t), FUN=mean)
```

```{r trajectories, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEtrajectories} For R0=1.25 and sigma=0.08, the number of hosts infected at each time period in deterministic solution (black line) and 5 stochastic solutions (colored lines) are plotted.'}
ggplot(jtd) +
  geom_line(data = jtse, aes(
    x = timestamp, y = value1,
    color = as.factor(traj)
  ), alpha = 0.8) +
  scale_color_viridis(discrete = TRUE) +
  theme_cowplot() +
  xlab("Time (days)") +
  ylab("Number of hosts infected") +
  ggtitle("R0 = 1.25, sigma = 0.08, w/ environmental noise") +
  geom_line(aes(x = timestamp, y = value1), lwd = 1.5) +
  theme(legend.position = "none") +
  ylim(0, 4500) #+geom_line(data=ahs, aes(x=Group.1, y=x), color='darkgrey', lwd=1.5)#+geom_line(data=ahds,aes(x=Group.1, y=x), color='grey', lwd=1.5)


ggsave("figures/trajectories-env.png", height = 7, width = 7)
```

```{r}
jtd <- read_csv("results/julia_trajectories_deterministic.csv")
jts1 <- read_csv("results/traj_detstoc_1.csv")
jts2 <- read_csv("results/traj_detstoc_2.csv")
jts3 <- read_csv("results/traj_detstoc_3.csv")
jts4 <- read_csv("results/traj_detstoc_4.csv")
jts5 <- read_csv("results/traj_detstoc_5.csv")
jts1$traj <- 1
jts2$traj <- 4
jts3$traj <- 3
jts4$traj <- 2
jts5$traj <- 5
jtsd <- rbind(jts1, jts2, jts3, jts4, jts5)
jtsd <- jtsd[jtsd$value2 >= 0, ]
jtsd <- jtsd[jtsd$value1 >= 0, ]
```

```{r trajectories, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEtrajectories} For R0=1.25 and sigma=0.08, the number of hosts infected at each time period in deterministic solution (black line) and 5 stochastic solutions (colored lines) are plotted.'}
ggplot(jtd) +
  geom_line(data = jtsd, aes(x = timestamp, y = value1, color = as.factor(traj)), alpha = 0.8) +
  scale_color_viridis(discrete = TRUE) +
  theme_cowplot() +
  xlab("Time (days)") +
  ylab("Number of hosts infected") +
  ggtitle("R0 = 1.25, sigma = 0.08, w/o environmental noise") +
  geom_line(aes(x = timestamp, y = value1), lwd = 1.5) +
  ylim(0, 4500) +
  theme(legend.position = "none") #+geom_line(data=ahs, aes(x=Group.1, y=x), color='darkgrey', lwd=1.5)#+geom_line(data=ahds,aes(x=Group.1, y=x), color='grey', lwd=1.5)


ggsave("figures/trajectories-det.png", height = 7, width = 7)
```


```{r trajectories-2, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEtrajectories-2} For R0=1.25 and sigma=0.08, the number of hosts infected at each time period in deterministic solution (black line) and 5 stochastic solutions (colored lines) are plotted.'}
library(ggnewscale)

ggplot(jtd) +
  ylab("Number of hosts infected") +
  ylim(0, 4500) +
  geom_line(data = jtse, aes(x = timestamp, y = value1, alpha = 0.5, color = as.factor(traj))) +
  scale_color_manual(values = c("orange", "darkorange", "chocolate2", "tan1", "darkorange2")) +
  new_scale_colour() +
  geom_line(data = jtsd, aes(x = timestamp, y = value1, alpha = 0.5, color = as.factor(traj))) +
  scale_color_manual(values = c("darkgreen", "green", "darkolivegreen2", "green3", "olivedrab")) +
  new_scale_colour() +
  theme_cowplot() +
  xlab("Time (days)") +
  theme(legend.position = "none") +
  geom_line(aes(x = timestamp, y = value1), lwd = 1)

ggsave("figures/trajectories-combined.png", height = 3, width = 7)
```

```{r}
jtd <- read_csv("results/julia_trajectories_6.5deterministic.csv")
jts1 <- read_csv("results/traj_6.5envstoc_1.csv")
jts2 <- read_csv("results/traj_6.5envstoc_2.csv")
jts3 <- read_csv("results/traj_6.5envstoc_3.csv")
jts4 <- read_csv("results/traj_6.5envstoc_4.csv")
jts5 <- read_csv("results/traj_6.5envstoc_5.csv")
jts1$traj <- 1
jts2$traj <- 2
jts3$traj <- 4
jts4$traj <- 3
jts5$traj <- 5
jtse <- rbind(jts1, jts2, jts3, jts4, jts5)
jtse <- jtse[jtse$value2 >= 0, ]
jtse <- jtse[jtse$value1 >= 0, ]
jtse <- jtse[jtse$value2 <= 100000, ]
jtse <- jtse[jtse$value1 <= 10000, ]
```

```{r trajectories, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEtrajectories} For R0=1.25 and sigma=0.08, the number of hosts infected at each time period in deterministic solution (black line) and 5 stochastic solutions (colored lines) are plotted.'}
ggplot(jtd) +
  geom_line(data = jtse, aes(x = (timestamp / 365), y = value1, color = as.factor(traj)), alpha = 0.8) +
  scale_color_viridis(discrete = TRUE) +
  theme_cowplot() +
  xlab("Time (years)") +
  ylab("Number of hosts infected") +
  geom_line(aes(x = (timestamp / 365), y = value1), lwd = 1.5) #+theme(legend.position="none")#+geom_line(data=ahs, aes(x=Group.1, y=x), color='darkgrey', lwd=1.5)#+geom_line(data=ahds,aes(x=Group.1, y=x), color='grey', lwd=1.5)


ggsave("figures/trajectories-env.png", height = 7, width = 7)
```



#Start of Alpha tests
1. only biting rate noise turned on
```{r}
jopab <- read.csv("results/alpha_test_b_on.csv")
jopab$R0 <- jopab$Thv
Thv_list <- unique(jopab$Thv)
jopab$R0 <- replace(jopab$R0, jopab$R0 == Thv_list[1], 0.75)
jopab$R0 <- replace(jopab$R0, jopab$R0 == Thv_list[2], 0.95)
jopab$R0 <- replace(jopab$R0, jopab$R0 == Thv_list[3], 1.05)
jopab$R0 <- replace(jopab$R0, jopab$R0 == Thv_list[4], 1.25)
jopab$R0 <- replace(jopab$R0, jopab$R0 == Thv_list[5], 2)
jopab$R0 <- replace(jopab$R0, jopab$R0 == Thv_list[6], 4)
jopab$R0 <- replace(jopab$R0, jopab$R0 == Thv_list[7], 6.5)
```

```{r prob_end, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEprob_end} Probability of the disease becoming endemic by sigma and R0 based on 1000 runs of 100 iterations. Overall, increasing environmental noise strength cases the probability that the disease becomes endemic to decrease. For smaller R0 values (i.e. <1.25), there is a slight increase in endemic disease probability at high environmental noise levels. Above environmental noise strength of 0.4 (where there is up to 40% variation in parameter values), the probability of endemic disease goes to zero. There is a greater probability of the disease going endemic at higher values of R0.'}
ggplot(jopab, aes(x = sigma, y = prob_end_mean)) +
  geom_line(aes(color = as.factor(R0))) +
  geom_point(aes(color = as.factor(R0))) +
  geom_ribbon(aes(ymin = prob_end_25, ymax = prob_end_75, fill = as.factor(R0)), alpha = 0.3) +
  ylab("Probability outbreak becomes endemic") +
  scale_color_manual(values = R0_cols, breaks = R0_vals) + 
  scale_fill_manual(values = R0_cols, breaks = R0_vals) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$"))) +
  ggtitle("alpha b on") +
  theme(text = element_text(size = 15))
ggsave("figures/alpha_b_eprob.png", height = 7, width = 7)
```

```{r prob_out10, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEprob_out10} Probability of an outbreak (defined as 10 host cases at one time point) occuring by sigma and R0 based on 1000 runs of 100 iterations. For R0 values greater than 1, as environmental noise strength increases the probability of an outbreak decreases. For R0 values less than 1, as environmental noise strength increases, the probability of an outbreak increases until sigma=~0.2 and then decreases. There is a greater probability of an outbreak at higher values of R0.'}
ggplot(jopab, aes(x = sigma, y = prob_out10_mean)) +
  geom_line(aes(color = as.factor(R0))) +
  geom_point(aes(color = as.factor(R0))) +
  geom_ribbon(aes(ymin = prob_out10_25, ymax = prob_out10_75, fill = as.factor(R0)), alpha = 0.3) +
  scale_color_viridis(discrete = TRUE, guide = "legend") +
  scale_fill_viridis(discrete = TRUE) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  ylab("Probability of an outbreak > 10") +
  ylim(0, 1) +
  scale_color_manual(values = R0_cols, breaks = R0_vals) + 
  scale_fill_manual(values = R0_cols, breaks = R0_vals) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$"))) +
  ggtitle("alpha b on") +
  theme(text = element_text(size = 15))
ggsave("figures/alpha_b_oprob10.png", height = 7, width = 7)
```

```{r max_cases_all, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEmax_cases_all} Maximum number of cases during the simulation by sigma and R0 based on 1000 runs of 100 iterations. For all R0 values, the maximum number of cases increases with environmental noise strength initially and then decreases as environmental noise strength gets too high. For high R0 values, the shift occurs at sigma=~0.15, and for lower R0 values, the shift occurs at sigma=~0.25. R0=1.25 shows intermediate behavior responding at both sigma values. With higher values of R0, more hosts are infected.'}
ggplot(jopab, aes(x = sigma, y = max_cases_all_mean)) +
  geom_line(aes(color = as.factor(R0))) +
  geom_point(aes(color = as.factor(R0))) +
  geom_ribbon(aes(ymin = max_cases_all_25, ymax = max_cases_all_75, fill = as.factor(R0)), alpha = 0.3) +
  ylab("Peak number of cases") +
  scale_color_manual(values = R0_cols, breaks = R0_vals) + 
  scale_fill_manual(values = R0_cols, breaks = R0_vals) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$"))) +
  ggtitle("alpha b on") +
  theme(text = element_text(size = 15))
ggsave("figures/alpha_b_peak.png", height = 7, width = 7)
```

2. only transmission probability from mosquitoes to hosts turned on for nosie
```{r}
jopat <- read.csv("results/alpha_test_t_on.csv")
jopat$R0 <- jopat$Thv
Thv_list <- unique(jopat$Thv)
jopat$R0 <- replace(jopat$R0, jopat$R0 == Thv_list[1], 0.75)
jopat$R0 <- replace(jopat$R0, jopat$R0 == Thv_list[2], 0.95)
jopat$R0 <- replace(jopat$R0, jopat$R0 == Thv_list[3], 1.05)
jopat$R0 <- replace(jopat$R0, jopat$R0 == Thv_list[4], 1.25)
jopat$R0 <- replace(jopat$R0, jopat$R0 == Thv_list[5], 2)
jopat$R0 <- replace(jopat$R0, jopat$R0 == Thv_list[6], 4)
jopat$R0 <- replace(jopat$R0, jopat$R0 == Thv_list[7], 6.5)
```

```{r prob_end, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEprob_end} Probability of the disease becoming endemic by sigma and R0 based on 1000 runs of 100 iterations. Overall, increasing environmental noise strength cases the probability that the disease becomes endemic to decrease. For smaller R0 values (i.e. <1.25), there is a slight increase in endemic disease probability at high environmental noise levels. Above environmental noise strength of 0.4 (where there is up to 40% variation in parameter values), the probability of endemic disease goes to zero. There is a greater probability of the disease going endemic at higher values of R0.'}
ggplot(jopat, aes(x = sigma, y = prob_end_mean)) +
  geom_line(aes(color = as.factor(R0))) +
  geom_point(aes(color = as.factor(R0))) +
  geom_ribbon(aes(ymin = prob_end_25, ymax = prob_end_75, fill = as.factor(R0)), alpha = 0.3) +
  ylab("Probability outbreak becomes endemic") +
  scale_color_manual(values = R0_cols, breaks = R0_vals) + 
  scale_fill_manual(values = R0_cols, breaks = R0_vals) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$"))) +
  ggtitle("alpha t on") +
  theme(text = element_text(size = 15))
ggsave("figures/alpha_t_eprob.png", height = 7, width = 7)
```

```{r prob_out10, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEprob_out10} Probability of an outbreak (defined as 10 host cases at one time point) occuring by sigma and R0 based on 1000 runs of 100 iterations. For R0 values greater than 1, as environmental noise strength increases the probability of an outbreak decreases. For R0 values less than 1, as environmental noise strength increases, the probability of an outbreak increases until sigma=~0.2 and then decreases. There is a greater probability of an outbreak at higher values of R0.'}
ggplot(jopat, aes(x = sigma, y = prob_out10_mean)) +
  geom_line(aes(color = as.factor(R0))) +
  geom_point(aes(color = as.factor(R0))) +
  geom_ribbon(aes(ymin = prob_out10_25, ymax = prob_out10_75, fill = as.factor(R0)), alpha = 0.3) +
  scale_color_viridis(discrete = TRUE, guide = "legend") +
  scale_fill_viridis(discrete = TRUE) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  ylab("Probability of an outbreak > 10") +
  ylim(0, 1) +
  scale_color_manual(values = R0_cols, breaks = R0_vals) + 
  scale_fill_manual(values = R0_cols, breaks = R0_vals) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$"))) +
  ggtitle("alpha t on") +
  theme(text = element_text(size = 15))
ggsave("figures/alpha_t_oprob10.png", height = 7, width = 7)
```

```{r prob_out100, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEprob_out10} Probability of an outbreak (defined as 10 host cases at one time point) occuring by sigma and R0 based on 1000 runs of 100 iterations. For R0 values greater than 1, as environmental noise strength increases the probability of an outbreak decreases. For R0 values less than 1, as environmental noise strength increases, the probability of an outbreak increases until sigma=~0.2 and then decreases. There is a greater probability of an outbreak at higher values of R0.'}
ggplot(jopat, aes(x = sigma, y = max_cases_all_mean)) +
  geom_line(aes(color = as.factor(R0))) +
  geom_point(aes(color = as.factor(R0))) +
  geom_ribbon(aes(ymin = max_cases_all_25, ymax = max_cases_all_75, fill = as.factor(R0)), alpha = 0.3) +
  ylab("Peak number of cases") +
  scale_color_manual(values = R0_cols, breaks = R0_vals) + 
  scale_fill_manual(values = R0_cols, breaks = R0_vals) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$"))) +
  ggtitle("alpha t on") +
  theme(text = element_text(size = 15))
ggsave("figures/alpha_t_peak.png", height = 7, width = 7)
```



3. only mortality rate noise turned on

```{r}
jopam <- read.csv("results/alpha_test_m_on.csv")
jopam$R0 <- jopam$Thv
Thv_list <- unique(jopam$Thv)
jopam$R0 <- replace(jopam$R0, jopam$R0 == Thv_list[1], 0.75)
jopam$R0 <- replace(jopam$R0, jopam$R0 == Thv_list[2], 0.95)
jopam$R0 <- replace(jopam$R0, jopam$R0 == Thv_list[3], 1.05)
jopam$R0 <- replace(jopam$R0, jopam$R0 == Thv_list[4], 1.25)
jopam$R0 <- replace(jopam$R0, jopam$R0 == Thv_list[5], 2)
jopam$R0 <- replace(jopam$R0, jopam$R0 == Thv_list[6], 4)
jopam$R0 <- replace(jopam$R0, jopam$R0 == Thv_list[7], 6.5)
```

```{r prob_end, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEprob_end} Probability of the disease becoming endemic by sigma and R0 based on 1000 runs of 100 iterations. Overall, increasing environmental noise strength cases the probability that the disease becomes endemic to decrease. For smaller R0 values (i.e. <1.25), there is a slight increase in endemic disease probability at high environmental noise levels. Above environmental noise strength of 0.4 (where there is up to 40% variation in parameter values), the probability of endemic disease goes to zero. There is a greater probability of the disease going endemic at higher values of R0.'}
ggplot(jopam, aes(x = sigma, y = prob_end_mean)) +
  geom_line(aes(color = as.factor(R0))) +
  geom_point(aes(color = as.factor(R0))) +
  geom_ribbon(aes(ymin = prob_end_25, ymax = prob_end_75, fill = as.factor(R0)), alpha = 0.3) +
  ylab("Probability outbreak becomes endemic") +
  scale_color_manual(values = R0_cols, breaks = R0_vals) + 
  scale_fill_manual(values = R0_cols, breaks = R0_vals) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$"))) +
  ggtitle("alpha m on") +
  theme(text = element_text(size = 15))
ggsave("figures/alpha_m_eprob.png", height = 7, width = 7)
```

```{r prob_out10, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEprob_out10} Probability of an outbreak (defined as 10 host cases at one time point) occuring by sigma and R0 based on 1000 runs of 100 iterations. For R0 values greater than 1, as environmental noise strength increases the probability of an outbreak decreases. For R0 values less than 1, as environmental noise strength increases, the probability of an outbreak increases until sigma=~0.2 and then decreases. There is a greater probability of an outbreak at higher values of R0.'}
ggplot(jopam, aes(x = sigma, y = prob_out10_mean)) +
  geom_line(aes(color = as.factor(R0))) +
  geom_point(aes(color = as.factor(R0))) +
  geom_ribbon(aes(ymin = prob_out10_25, ymax = prob_out10_75, fill = as.factor(R0)), alpha = 0.3) +
  scale_color_viridis(discrete = TRUE, guide = "legend") +
  scale_fill_viridis(discrete = TRUE) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  ylab("Probability of an outbreak > 10") +
  ylim(0, 1) +
  scale_color_manual(values = R0_cols, breaks = R0_vals) + 
  scale_fill_manual(values = R0_cols, breaks = R0_vals) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$"))) +
  ggtitle("alpha m on") +
  theme(text = element_text(size = 15))
ggsave("figures/alpha_m_oprob10.png", height = 7, width = 7)
```

```{r prob_out100, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEprob_out10} Probability of an outbreak (defined as 10 host cases at one time point) occuring by sigma and R0 based on 1000 runs of 100 iterations. For R0 values greater than 1, as environmental noise strength increases the probability of an outbreak decreases. For R0 values less than 1, as environmental noise strength increases, the probability of an outbreak increases until sigma=~0.2 and then decreases. There is a greater probability of an outbreak at higher values of R0.'}
ggplot(jopam, aes(x = sigma, y = max_cases_all_mean)) +
  geom_line(aes(color = as.factor(R0))) +
  geom_point(aes(color = as.factor(R0))) +
  geom_ribbon(aes(ymin = max_cases_all_25, ymax = max_cases_all_75, fill = as.factor(R0)), alpha = 0.3) +
  ylab("Peak number of cases") +
  scale_color_manual(values = R0_cols, breaks = R0_vals) + 
  scale_fill_manual(values = R0_cols, breaks = R0_vals) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$"))) +
  ggtitle("alpha m on") +
  theme(text = element_text(size = 15))
ggsave("figures/alpha_m_peak.png", height = 7, width = 7)
```




4. One parameter turned off for noise at a time
```{r}
jopabt <- read.csv("results/alpha_test_bt_on.csv")
jopabt$R0 <- jopabt$Thv
Thv_list <- unique(jopabt$Thv)
jopabt$R0 <- replace(jopabt$R0, jopabt$R0 == Thv_list[1], 0.75)
jopabt$R0 <- replace(jopabt$R0, jopabt$R0 == Thv_list[2], 0.95)
jopabt$R0 <- replace(jopabt$R0, jopabt$R0 == Thv_list[3], 1.05)
jopabt$R0 <- replace(jopabt$R0, jopabt$R0 == Thv_list[4], 1.25)
jopabt$R0 <- replace(jopabt$R0, jopabt$R0 == Thv_list[5], 2)
jopabt$R0 <- replace(jopabt$R0, jopabt$R0 == Thv_list[6], 4)
jopabt$R0 <- replace(jopabt$R0, jopabt$R0 == Thv_list[7], 6.5)
```

```{r prob_end, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEprob_end} Probability of the disease becoming endemic by sigma and R0 based on 1000 runs of 100 iterations. Overall, increasing environmental noise strength cases the probability that the disease becomes endemic to decrease. For smaller R0 values (i.e. <1.25), there is a slight increase in endemic disease probability at high environmental noise levels. Above environmental noise strength of 0.4 (where there is up to 40% variation in parameter values), the probability of endemic disease goes to zero. There is a greater probability of the disease going endemic at higher values of R0.'}
ggplot(jopabt, aes(x = sigma, y = prob_end_mean)) +
  geom_line(aes(color = as.factor(R0))) +
  geom_point(aes(color = as.factor(R0))) +
  geom_ribbon(aes(ymin = prob_end_25, ymax = prob_end_75, fill = as.factor(R0)), alpha = 0.3) +
  ylab("Probability outbreak becomes endemic") +
  scale_color_manual(values = R0_cols, breaks = R0_vals) + 
  scale_fill_manual(values = R0_cols, breaks = R0_vals) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$"))) +
  ggtitle("alpha b, t on") +
  theme(text = element_text(size = 15))
ggsave("figures/alpha_bt_eprob.png", height = 7, width = 7)
```
```{r prob_out10, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEprob_out10} Probability of an outbreak (defined as 10 host cases at one time point) occuring by sigma and R0 based on 1000 runs of 100 iterations. For R0 values greater than 1, as environmental noise strength increases the probability of an outbreak decreases. For R0 values less than 1, as environmental noise strength increases, the probability of an outbreak increases until sigma=~0.2 and then decreases. There is a greater probability of an outbreak at higher values of R0.'}
ggplot(jopabt, aes(x = sigma, y = prob_out10_mean)) +
  geom_line(aes(color = as.factor(R0))) +
  geom_point(aes(color = as.factor(R0))) +
  geom_ribbon(aes(ymin = prob_out10_25, ymax = prob_out10_75, fill = as.factor(R0)), alpha = 0.3) +
  scale_color_viridis(discrete = TRUE, guide = "legend") +
  scale_fill_viridis(discrete = TRUE) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  ylab("Probability of an outbreak > 10") +
  ylim(0, 1) +
  scale_color_manual(values = R0_cols, breaks = R0_vals) + 
  scale_fill_manual(values = R0_cols, breaks = R0_vals) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$"))) +
  ggtitle("alpha b, t on") +
  theme(text = element_text(size = 15))
ggsave("figures/alpha_bt_oprob10.png", height = 7, width = 7)
```
```{r prob_out100, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEprob_out10} Probability of an outbreak (defined as 10 host cases at one time point) occuring by sigma and R0 based on 1000 runs of 100 iterations. For R0 values greater than 1, as environmental noise strength increases the probability of an outbreak decreases. For R0 values less than 1, as environmental noise strength increases, the probability of an outbreak increases until sigma=~0.2 and then decreases. There is a greater probability of an outbreak at higher values of R0.'}
ggplot(jopabt, aes(x = sigma, y = max_cases_all_mean)) +
  geom_line(aes(color = as.factor(R0))) +
  geom_point(aes(color = as.factor(R0))) +
  geom_ribbon(aes(ymin = max_cases_all_25, ymax = max_cases_all_75, fill = as.factor(R0)), alpha = 0.3) +
  ylab("Peak number of cases") +
  scale_color_manual(values = R0_cols, breaks = R0_vals) + 
  scale_fill_manual(values = R0_cols, breaks = R0_vals) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$"))) +
  ggtitle("alpha b, t on") +
  theme(text = element_text(size = 15))
ggsave("figures/alpha_bt_peak.png", height = 7, width = 7)
```


```{r}
jopabm <- read.csv("results/alpha_test_bm_on.csv")
jopabm$R0 <- jopabm$Thv
Thv_list <- unique(jopabm$Thv)
jopabm$R0 <- replace(jopabm$R0, jopabm$R0 == Thv_list[1], 0.75)
jopabm$R0 <- replace(jopabm$R0, jopabm$R0 == Thv_list[2], 0.95)
jopabm$R0 <- replace(jopabm$R0, jopabm$R0 == Thv_list[3], 1.05)
jopabm$R0 <- replace(jopabm$R0, jopabm$R0 == Thv_list[4], 1.25)
jopabm$R0 <- replace(jopabm$R0, jopabm$R0 == Thv_list[5], 2)
jopabm$R0 <- replace(jopabm$R0, jopabm$R0 == Thv_list[6], 4)
jopabm$R0 <- replace(jopabm$R0, jopabm$R0 == Thv_list[7], 6.5)
```

```{r prob_end, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEprob_end} Probability of the disease becoming endemic by sigma and R0 based on 1000 runs of 100 iterations. Overall, increasing environmental noise strength cases the probability that the disease becomes endemic to decrease. For smaller R0 values (i.e. <1.25), there is a slight increase in endemic disease probability at high environmental noise levels. Above environmental noise strength of 0.4 (where there is up to 40% variation in parameter values), the probability of endemic disease goes to zero. There is a greater probability of the disease going endemic at higher values of R0.'}
ggplot(jopabm, aes(x = sigma, y = prob_end_mean)) +
  geom_line(aes(color = as.factor(R0))) +
  geom_point(aes(color = as.factor(R0))) +
  geom_ribbon(aes(ymin = prob_end_25, ymax = prob_end_75, fill = as.factor(R0)), alpha = 0.3) +
  ylab("Probability outbreak becomes endemic") +
  scale_color_manual(values = R0_cols, breaks = R0_vals) + 
  scale_fill_manual(values = R0_cols, breaks = R0_vals) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$"))) +
  ggtitle("alpha b, m on") +
  theme(text = element_text(size = 15))
ggsave("figures/alpha_bm_eprob.png", height = 7, width = 7)
```
```{r prob_out10, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEprob_out10} Probability of an outbreak (defined as 10 host cases at one time point) occuring by sigma and R0 based on 1000 runs of 100 iterations. For R0 values greater than 1, as environmental noise strength increases the probability of an outbreak decreases. For R0 values less than 1, as environmental noise strength increases, the probability of an outbreak increases until sigma=~0.2 and then decreases. There is a greater probability of an outbreak at higher values of R0.'}
ggplot(jopabm, aes(x = sigma, y = prob_out10_mean)) +
  geom_line(aes(color = as.factor(R0))) +
  geom_point(aes(color = as.factor(R0))) +
  geom_ribbon(aes(ymin = prob_out10_25, ymax = prob_out10_75, fill = as.factor(R0)), alpha = 0.3) +
  scale_color_viridis(discrete = TRUE, guide = "legend") +
  scale_fill_viridis(discrete = TRUE) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  ylab("Probability of an outbreak > 10") +
  ylim(0, 1) +
  scale_color_manual(values = R0_cols, breaks = R0_vals) + 
  scale_fill_manual(values = R0_cols, breaks = R0_vals) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$"))) +
  ggtitle("alpha b, m on") +
  theme(text = element_text(size = 15))
ggsave("figures/alpha_bm_oprob10.png", height = 7, width = 7)
```
```{r prob_out100, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEprob_out10} Probability of an outbreak (defined as 10 host cases at one time point) occuring by sigma and R0 based on 1000 runs of 100 iterations. For R0 values greater than 1, as environmental noise strength increases the probability of an outbreak decreases. For R0 values less than 1, as environmental noise strength increases, the probability of an outbreak increases until sigma=~0.2 and then decreases. There is a greater probability of an outbreak at higher values of R0.'}
ggplot(jopabm, aes(x = sigma, y = max_cases_all_mean)) +
  geom_line(aes(color = as.factor(R0))) +
  geom_point(aes(color = as.factor(R0))) +
  geom_ribbon(aes(ymin = max_cases_all_25, ymax = max_cases_all_75, fill = as.factor(R0)), alpha = 0.3) +
  ylab("Peak number of cases") +
  scale_color_manual(values = R0_cols, breaks = R0_vals) + 
  scale_fill_manual(values = R0_cols, breaks = R0_vals) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$"))) +
  ggtitle("alpha b, m on") +
  theme(text = element_text(size = 15))
ggsave("figures/alpha_bm_peak.png", height = 7, width = 7)
```


```{r}
jopatm <- read.csv("results/alpha_test_tm_on.csv")
jopatm$R0 <- jopatm$Thv
Thv_list <- unique(jopatm$Thv)
jopatm$R0 <- replace(jopatm$R0, jopatm$R0 == Thv_list[1], 0.75)
jopatm$R0 <- replace(jopatm$R0, jopatm$R0 == Thv_list[2], 0.95)
jopatm$R0 <- replace(jopatm$R0, jopatm$R0 == Thv_list[3], 1.05)
jopatm$R0 <- replace(jopatm$R0, jopatm$R0 == Thv_list[4], 1.25)
jopatm$R0 <- replace(jopatm$R0, jopatm$R0 == Thv_list[5], 2)
jopatm$R0 <- replace(jopatm$R0, jopatm$R0 == Thv_list[6], 4)
jopatm$R0 <- replace(jopatm$R0, jopatm$R0 == Thv_list[7], 6.5)
```

```{r prob_end, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEprob_end} Probability of the disease becoming endemic by sigma and R0 based on 1000 runs of 100 iterations. Overall, increasing environmental noise strength cases the probability that the disease becomes endemic to decrease. For smaller R0 values (i.e. <1.25), there is a slight increase in endemic disease probability at high environmental noise levels. Above environmental noise strength of 0.4 (where there is up to 40% variation in parameter values), the probability of endemic disease goes to zero. There is a greater probability of the disease going endemic at higher values of R0.'}
ggplot(jopatm, aes(x = sigma, y = prob_end_mean)) +
  geom_line(aes(color = as.factor(R0))) +
  geom_point(aes(color = as.factor(R0))) +
  geom_ribbon(aes(ymin = prob_end_25, ymax = prob_end_75, fill = as.factor(R0)), alpha = 0.3) +
  ylab("Probability outbreak becomes endemic") +
  scale_color_manual(values = R0_cols, breaks = R0_vals) + 
  scale_fill_manual(values = R0_cols, breaks = R0_vals) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$"))) +
  ggtitle("alpha t, m on") +
  theme(text = element_text(size = 15))
ggsave("figures/alpha_tm_eprob.png", height = 7, width = 7)
```
```{r prob_out10, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEprob_out10} Probability of an outbreak (defined as 10 host cases at one time point) occuring by sigma and R0 based on 1000 runs of 100 iterations. For R0 values greater than 1, as environmental noise strength increases the probability of an outbreak decreases. For R0 values less than 1, as environmental noise strength increases, the probability of an outbreak increases until sigma=~0.2 and then decreases. There is a greater probability of an outbreak at higher values of R0.'}
ggplot(jopatm, aes(x = sigma, y = prob_out10_mean)) +
  geom_line(aes(color = as.factor(R0))) +
  geom_point(aes(color = as.factor(R0))) +
  geom_ribbon(aes(ymin = prob_out10_25, ymax = prob_out10_75, fill = as.factor(R0)), alpha = 0.3) +
  scale_color_viridis(discrete = TRUE, guide = "legend") +
  scale_fill_viridis(discrete = TRUE) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  ylab("Probability of an outbreak > 10") +
  ylim(0, 1) +
  scale_color_manual(values = R0_cols, breaks = R0_vals) + 
  scale_fill_manual(values = R0_cols, breaks = R0_vals) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$"))) +
  ggtitle("alpha t, m on") +
  theme(text = element_text(size = 15))
ggsave("figures/alpha_tm_oprob10.png", height = 7, width = 7)
```
```{r prob_out100, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEprob_out10} Probability of an outbreak (defined as 10 host cases at one time point) occuring by sigma and R0 based on 1000 runs of 100 iterations. For R0 values greater than 1, as environmental noise strength increases the probability of an outbreak decreases. For R0 values less than 1, as environmental noise strength increases, the probability of an outbreak increases until sigma=~0.2 and then decreases. There is a greater probability of an outbreak at higher values of R0.'}
ggplot(jopatm, aes(x = sigma, y = max_cases_all_mean)) +
  geom_line(aes(color = as.factor(R0))) +
  geom_point(aes(color = as.factor(R0))) +
  geom_ribbon(aes(ymin = max_cases_all_25, ymax = max_cases_all_75, fill = as.factor(R0)), alpha = 0.3) +
  ylab("Peak number of cases") +
  scale_color_manual(values = R0_cols, breaks = R0_vals) + 
  scale_fill_manual(values = R0_cols, breaks = R0_vals) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$"))) +
  ggtitle("alpha t, m on") +
  theme(text = element_text(size = 15))
ggsave("figures/alpha_tm_peak.png", height = 7, width = 7)
```

```{r stacked-sensitivity}

disc_sens_df <- rbind(mutate(jopab, label = "a", 
                             long_label = as.character(unname(TeX("(a) $\\alpha_{b}$ on")))),
                      mutate(jopat, label = "b", 
                             long_label = as.character(unname(TeX("(b) $\\alpha_{\\tau}$ on")))),
                      mutate(jopam, label = "c", 
                             long_label = as.character(unname(TeX("(c) $\\alpha_{\\mu}$ on")))),
                      mutate(jopabt, label = "d",
                             long_label = as.character(unname(TeX("(d) $\\alpha_{b}$ and $\\alpha_{\\tau}$ on")))),
                      mutate(jopabm, label = "e",
                             long_label = as.character(unname(TeX("(e) $\\alpha_{b}$ and $\\alpha_{\\mu}$ on")))),
                      mutate(jopatm, label = "f",
                             long_label = as.character(unname(TeX("(f) $\\alpha_{\\tau}$ and $\\alpha_{\\mu}$ on"))))
) %>% 
  select(label, long_label, sigma, prob_end_mean, prob_end_25, prob_end_75, R0) %>% 
  pivot_longer(cols = -c(sigma, R0, label, long_label)) %>% 
  mutate(#output = stringr::str_extract(name, "[^_]*_[^_]*"),
    type = stringi::stri_reverse(str_split_i(stringi::stri_reverse(name), '_', i = 1))
  ) %>% 
  select(-name) %>% 
  # mutate(across(label, ~factor(., levels = c("(a) $\\alpha_{b}$ on",
  #                       "(b) $\\alpha_{\\tau}$ on",
  #                       "(c) $\\alpha_{\\mu}$ on",
  #                       "(d) $\\alpha_{b}$ and $\\alpha_{\\tau}$ on",
  #                       "(e) $\\alpha_{b}$ and $\\alpha_{\\mu}$ on",
  #                       "(f) $\\alpha_{\\tau}$ and $\\alpha_{\\mu}$ on"
  # )))) %>% 
  pivot_wider(id_cols = c(sigma, R0, label, long_label), names_from = type) %>% 
  arrange(sigma, R0)

strip_labels <- list(TeX("(a) $\\alpha_{b}$ on"),
                     TeX("(b) $\\alpha_{\\tau}$ on"),
                     TeX("(c) $\\alpha_{\\mu}$ on"),
                     TeX("(d) $\\alpha_{b}$ and $\\alpha_{\\tau}$ on"),
                     TeX("(e) $\\alpha_{b}$ and $\\alpha_{\\mu}$ on"),
                     TeX("(f) $\\alpha_{\\tau}$ and $\\alpha_{\\mu}$ on"))

sens_labeller <- function(label_in) {
  out <- distinct(disc_sens_df, label, long_label) %>% 
    filter(label == label_in) %>% 
    select(long_label) %>% 
    c()
  return(out[[1]])
}


disc_sens_plot <- ggplot(disc_sens_df, aes(x = sigma)) +
  geom_line(aes(y = mean, color = as.factor(R0), group = as.factor(R0))) +
  geom_point(aes(y = mean, color = as.factor(R0), group = as.factor(R0))) +
  geom_ribbon(aes(ymin = `25`, ymax = `75`, fill = as.factor(R0)), alpha = 0.3) +
  # scale_color_viridis(discrete=TRUE, guide = "legend")+
  # scale_fill_viridis(discrete=TRUE)+
  scale_color_manual(values = R0_cols, breaks = R0_vals) + 
  scale_fill_manual(values = R0_cols, breaks = R0_vals) +
  facet_wrap(~ long_label, ncol = 3, scales = "free", labeller = label_parsed,  strip.position = "top") +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$"))) +
  ylab("Probability disease is endemic") +
  theme(strip.text.x = element_text(hjust = 0),
        strip.background = element_blank())
disc_sens_plot

ggsave("figures/disc_sens.png", plot = disc_sens_plot, height = 4, width = 7)

```





#Results from R0 controlled by gamma
```{r}
jopg <- read.csv("results/R0_controlled_by_gamma_1.csv")
jopg$R0 <- jopg$gamma
gamma_list <- unique(jopg$gamma)
jopg$R0 <- replace(jopg$R0, jopg$R0 == gamma_list[1], 0.75)
jopg$R0 <- replace(jopg$R0, jopg$R0 == gamma_list[2], 0.95)
jopg$R0 <- replace(jopg$R0, jopg$R0 == gamma_list[3], 1.05)
jopg$R0 <- replace(jopg$R0, jopg$R0 == gamma_list[4], 1.25)
jopg$R0 <- replace(jopg$R0, jopg$R0 == gamma_list[5], 2)
jopg$R0 <- replace(jopg$R0, jopg$R0 == gamma_list[6], 4)
jopg$R0 <- replace(jopg$R0, jopg$R0 == gamma_list[7], 6.5)
```

```{r prob_end, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEprob_end} Probability of the disease becoming endemic by sigma and R0 based on 1000 runs of 100 iterations. Overall, increasing environmental noise strength cases the probability that the disease becomes endemic to decrease. For smaller R0 values (i.e. <1.25), there is a slight increase in endemic disease probability at high environmental noise levels. Above environmental noise strength of 0.4 (where there is up to 40% variation in parameter values), the probability of endemic disease goes to zero. There is a greater probability of the disease going endemic at higher values of R0.'}
ggplot(jopg[jopg$R0 > 1.5, ], aes(x = sigma, y = prob_end_mean)) +
  geom_line(aes(color = as.factor(R0))) +
  geom_point(aes(color = as.factor(R0))) +
  geom_ribbon(aes(ymin = prob_end_25, ymax = prob_end_75, fill = as.factor(R0)), alpha = 0.3) +
  scale_color_viridis(discrete = TRUE, guide = "legend") +
  scale_fill_viridis(discrete = TRUE) +
  theme_cowplot() +
  ylab("Probability outbreak becomes endemic") +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$")))

ggsave("figures/prob_end.png", height = 4, width = 7)
```


```{r}
jopost <- read.csv("results/out_stats_test.csv")
```

#Julia Final Results
```{r}
jop1 <- read.csv("results/julia_mean_1.csv")
jop2 <- read.csv("results/julia_mean_2.csv")
jop3 <- read.csv("results/julia_mean_3.csv")
jop4 <- read.csv("results/julia_mean_4.csv")
jop5 <- read.csv("results/julia_mean_5.csv")
jop6 <- read.csv("results/julia_mean_6.csv")
jop7 <- read.csv("results/julia_mean_7.csv")

jop <- rbind(jop1, jop2, jop3, jop4, jop5, jop6, jop7)
jop$R0 <- jop$Thv
Thv_list <- unique(jop$Thv)
jop$R0 <- replace(jop$R0, jop$R0 == Thv_list[1], 0.75)
jop$R0 <- replace(jop$R0, jop$R0 == Thv_list[2], 0.95)
jop$R0 <- replace(jop$R0, jop$R0 == Thv_list[3], 1.05)
jop$R0 <- replace(jop$R0, jop$R0 == Thv_list[4], 1.25)
jop$R0 <- replace(jop$R0, jop$R0 == Thv_list[5], 2)
jop$R0 <- replace(jop$R0, jop$R0 == Thv_list[6], 4)
jop$R0 <- replace(jop$R0, jop$R0 == Thv_list[7], 6.5)
```

```{r prob_end, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEprob_end} Probability of the disease becoming endemic by sigma and R0 based on 1000 runs of 100 iterations. Overall, increasing environmental noise strength cases the probability that the disease becomes endemic to decrease. For smaller R0 values (i.e. <1.25), there is a slight increase in endemic disease probability at high environmental noise levels. Above environmental noise strength of 0.4 (where there is up to 40% variation in parameter values), the probability of endemic disease goes to zero. There is a greater probability of the disease going endemic at higher values of R0.'}
ggplot(jop, aes(x = sigma, y = prob_end_mean)) +
  geom_line(aes(color = as.factor(R0))) +
  geom_point(aes(color = as.factor(R0))) +
  geom_ribbon(aes(ymin = prob_end_25, ymax = prob_end_75, fill = as.factor(R0)), alpha = 0.3) +
  # scale_color_viridis(discrete=TRUE, guide = "legend")+
  # scale_fill_viridis(discrete=TRUE)+
  scale_color_manual(values = R0_cols, breaks = R0_vals) + 
  scale_fill_manual(values = R0_cols, breaks = R0_vals) +
  theme_cowplot() +
  ylab("Probability of endemic disease") +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$")))

ggsave("figures/prob_end.png", height = 3.5, width = 7)
```
```{r prob_out10, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEprob_out10} Probability of an outbreak (defined as 10 host cases at one time point) occuring by sigma and R0 based on 1000 runs of 100 iterations. For R0 values greater than 1, as environmental noise strength increases the probability of an outbreak decreases. For R0 values less than 1, as environmental noise strength increases, the probability of an outbreak increases until sigma=~0.2 and then decreases. There is a greater probability of an outbreak at higher values of R0.'}
ggplot(jop, aes(x = sigma, y = prob_out10_mean)) +
  geom_line(aes(color = as.factor(R0))) +
  geom_point(aes(color = as.factor(R0))) +
  geom_ribbon(aes(ymin = prob_out10_25, ymax = prob_out10_75, fill = as.factor(R0)), alpha = 0.3) +
  # scale_color_viridis(discrete=TRUE, guide = "legend")+
  # scale_fill_viridis(discrete=TRUE)+
  scale_color_manual(values = R0_cols, breaks = R0_vals) + 
  scale_fill_manual(values = R0_cols, breaks = R0_vals) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  ylab("Probability of outbreak > 10 hosts") +
  ylim(0, 1) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$")))
ggsave("figures/prob_out10.png", height = 3.5, width = 7)
```
```{r max_cases_all, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEmax_cases_all} Maximum number of cases during the simulation by sigma and R0 based on 1000 runs of 100 iterations. For all R0 values, the maximum number of cases increases with environmental noise strength initially and then decreases as environmental noise strength gets too high. For high R0 values, the shift occurs at sigma=~0.15, and for lower R0 values, the shift occurs at sigma=~0.25. R0=1.25 shows intermediate behavior responding at both sigma values. With higher values of R0, more hosts are infected.'}
ggplot(jop, aes(x = sigma, y = max_cases_all_mean)) +
  geom_line(aes(color = as.factor(R0))) +
  geom_point(aes(color = as.factor(R0))) +
  geom_ribbon(aes(ymin = max_cases_all_25, ymax = max_cases_all_75, fill = as.factor(R0)), alpha = 0.3) +
  ylab("Peak number of cases") +
  # scale_color_viridis(discrete=TRUE, guide = "legend")+scale_fill_viridis(discrete=TRUE)+
  scale_color_manual(values = R0_cols, breaks = R0_vals) + 
  scale_fill_manual(values = R0_cols, breaks = R0_vals) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$"))) #+
# ggtitle("All simulations") +
# theme(text = element_text(size = 20))
ggsave("figures/max_cases.png", height = 3.5, width = 7)
```
```{r max_cases_out, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEmax_cases_all} Maximum number of cases during the simulation by sigma and R0 based on 1000 runs of 100 iterations only including simulations where the outbreak died out. For all R0 values, the maximum number of cases increases with environmental noise strength initially and then decreases as environmental noise strength gets too high. For high R0 values, the shift occurs at sigma=~0.15, and for lower R0 values, the shift occurs at sigma=~0.25. R0=1.25 shows intermediate behavior responding at both sigma values. With higher values of R0, more hosts are infected.'}
ggplot(jop, aes(x = sigma, y = max_cases_out_mean)) +
  geom_line(aes(color = as.factor(R0))) +
  geom_point(aes(color = as.factor(R0))) +
  geom_ribbon(aes(ymin = max_cases_out_25, ymax = max_cases_out_75, fill = as.factor(R0)), alpha = 0.3) +
  ylab("Peak number of cases") +
  # scale_color_viridis(discrete=TRUE, guide = "legend")+scale_fill_viridis(discrete=TRUE)+
  scale_color_manual(values = R0_cols, breaks = R0_vals) + 
  scale_fill_manual(values = R0_cols, breaks = R0_vals) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$"))) +
  ggtitle("Simulations where disease died out") +
  theme(text = element_text(size = 20))
ggsave("figures/max_cases_out.png", height = 7, width = 7.6)
```
```{r end_time, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEend_time} Time that the outbreak dies out (or 10 years-end of simulation) by sigma and R0 based on 1000 runs of 100 iterations. This graph looks quite similar to that of the probability of disease going endemic, because if the disease does not go endemic, the disease goes extinct early on in the simulation.'}
ggplot(jop, aes(x = sigma, y = end_time_mean / 365)) +
  geom_line(aes(color = as.factor(R0))) +
  geom_point(aes(color = as.factor(R0))) +
  geom_ribbon(aes(ymin = end_time_25 / 365, ymax = end_time_75 / 365, fill = as.factor(R0)), alpha = 0.3) +
  ylab("Outbreak duration (years)") +
  # scale_color_viridis(discrete=TRUE, guide = "legend")+scale_fill_viridis(discrete=TRUE)+
  scale_color_manual(values = R0_cols, breaks = R0_vals) + 
  scale_fill_manual(values = R0_cols, breaks = R0_vals) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$"))) +
  ggtitle("All simulations") +
  theme(text = element_text(size = 20))
ggsave("figures/end_time.png", height = 7, width = 7.6)
```
```{r end_time_out, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEend_time} Time that the outbreak dies out (or 10 years-end of simulation) by sigma and R0 based on 1000 runs of 100 iterations. This graph looks quite similar to that of the probability of disease going endemic, because if the disease does not go endemic, the disease goes extinct early on in the simulation.'}
ggplot(jop, aes(x = sigma, y = end_time_out_mean / 365)) +
  geom_line(aes(color = as.factor(R0))) +
  geom_point(aes(color = as.factor(R0))) +
  geom_ribbon(aes(ymin = end_time_out_25 / 365, ymax = end_time_out_75 / 365, fill = as.factor(R0)), alpha = 0.3) +
  ylab("Outbreak duration (years)") +
  # scale_color_viridis(discrete=TRUE, guide = "legend")+scale_fill_viridis(discrete=TRUE)+
  scale_color_manual(values = R0_cols, breaks = R0_vals) + 
  scale_fill_manual(values = R0_cols, breaks = R0_vals) +
  theme_cowplot() +
  labs(color = unname(TeX("$R_0$")), fill = unname(TeX("$R_0$"))) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$"))) +
  ggtitle("Simulations where disease died out") +
  theme(text = element_text(size = 20))
ggsave("figures/end_time_out.png", height = 7, width = 7.6)
```


#sensitivity analysis
```{r}
sa <- read.csv("results/sensitivity_analysis_1000x100.csv")
```
```{r sa_oprob, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEend_time} Sensitivity analysis of parameters on outbreak probability based on 1000 runs of 100 iterations.'}
ggplot(sa, aes(x = sigma, y = PRCC_b_oprob)) +
  geom_line(color = "green") +
  geom_point(color = "green") +
  geom_line(aes(x = sigma, y = PRCC_muv_oprob), color = "orange") +
  geom_point(aes(x = sigma, y = PRCC_muv_oprob), color = "orange") +
  geom_line(aes(x = sigma, y = PRCC_tvh_oprob), color = "purple") +
  geom_point(aes(x = sigma, y = PRCC_tvh_oprob), color = "purple") +
  geom_line(aes(x = sigma, y = PRCC_fake_oprob), color = "black") +
  geom_point(aes(x = sigma, y = PRCC_fake_oprob), color = "black") +
  geom_ribbon(aes(ymin = -PRCC_fake_oprob, ymax = PRCC_fake_oprob), fill = "darkgrey", alpha = 0.3) +
  ylab("PRCC") +
  theme_cowplot() +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$"))) +
  ggtitle("Sensitivity of outbreak probability") +
  theme(text = element_text(size = 20))
ggsave("figures/sa_oprob.png", height = 7, width = 7.6)
```
```{r sa_eprob, out.width='100%', fig.align='center', fig.cap='\\label{fig:SDEend_time} Sensitivity analysis of parameters on outbreak probability based on 1000 runs of 100 iterations.'}
ggplot(sa, aes(x = sigma, y = PRCC_b_eprob)) +
  geom_line(color = "green") +
  geom_point(color = "green") +
  geom_line(aes(x = sigma, y = PRCC_muv_eprob), color = "orange") +
  geom_point(aes(x = sigma, y = PRCC_muv_eprob), color = "orange") +
  geom_line(aes(x = sigma, y = PRCC_tvh_eprob), color = "purple") +
  geom_point(aes(x = sigma, y = PRCC_tvh_eprob), color = "purple") +
  geom_line(aes(x = sigma, y = PRCC_fake_eprob), color = "black") +
  geom_point(aes(x = sigma, y = PRCC_fake_eprob), color = "black") +
  geom_ribbon(aes(ymin = -PRCC_fake_eprob, ymax = PRCC_fake_eprob), fill = "darkgrey", alpha = 0.3) +
  ylab("PRCC") +
  theme_cowplot() +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$"))) +
  ggtitle("Sensitivity of endemic disease probability") +
  theme(text = element_text(size = 20))
ggsave("figures/sa_eprob.png", height = 7, width = 7.6)
```

```{r new_sens_plots}

# Helper function: place legends in empty facets of plot grids
# Code by: Artem Sokolov, found here: https://stackoverflow.com/questions/54438495/shift-legend-into-empty-facets-of-a-faceted-plot-in-ggplot2
shift_legend <- function(p) {
  pnls <- cowplot::plot_to_gtable(p) %>%
    gtable::gtable_filter("panel") %>%
    with(setNames(grobs, layout$name)) %>%
    purrr::keep(~ identical(.x, zeroGrob()))
  
  if (length(pnls) == 0) stop("No empty facets in the plot")
  
  lemon::reposition_legend(p, "center", panel = names(pnls))
}

new_sens <- read.csv("code/julia/sensitivity_analysis_new_all.csv") %>% 
  pivot_longer(cols = -"sigma", names_prefix = "PRCC_", values_to = "value", names_to = "name") %>% 
  separate_wider_delim(name, delim = "_", names = c("variable", "output")) %>% 
  mutate(output = case_when(
    output == "eprob" ~ "(a) Probability disease is endemic",
    output == "o10prob" ~ "(b) Probability of an outbreak > 10 hosts",
    output == "o100prob" ~ "(c) Probability of an outbreak > 100 hosts",
    output == "peak" ~ "(d) Peak number of cases",
    output == "dur" ~ "(e) Outbreak duration",
  ),
  variable = case_when(
    variable == "b" ~ as.character(unname(TeX("$b$"))),
    variable == "muv" ~ as.character(unname(TeX("$\\mu_V$"))),
    variable == "tvh" ~ as.character(unname(TeX("$\\tau_{VH}$"))),
    variable == "fake" ~ "Dummy"
  ))

var_levs <-  c(as.character(unname(TeX("$b$"))),
               as.character(unname(TeX("$\\tau_{VH}$"))),
               as.character(unname(TeX("$\\mu_V$"))),
               "Dummy")


ribbon_df <- right_join(filter(new_sens, variable == "Dummy") %>% mutate(min = -abs(value)) %>%  select(-value),
                        filter(new_sens, variable == "Dummy") %>% mutate(max = abs(value)) %>% select(-value))

new_sens_plot <- filter(new_sens, variable != "Dummy") %>% 
  ggplot(aes(x = sigma, color = variable, fill = variable)) +
  geom_point(aes(y = value)) +
  geom_line(aes(y = value)) +
  geom_ribbon(data = ribbon_df, aes(ymin = min, ymax = max), alpha = 0.3) +
  facet_wrap(~ output) +
  theme_cowplot() +
  ylab("") +
  labs(color = unname(TeX("Variable")), fill = unname(TeX("Variable"))) +
  scale_color_discrete(labels = parse_format(),
                       breaks = var_levs) +
  scale_fill_discrete(labels = parse_format(),
                      breaks = var_levs) +
  xlab(unname(TeX("Environmental noise strength $(\\sigma)$"))) +
  theme(strip.text.x = element_text(hjust = 0),
        strip.background = element_blank())

shift_legend(new_sens_plot)



```
